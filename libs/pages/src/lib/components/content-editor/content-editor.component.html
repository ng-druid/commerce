<form *ngIf="!nested; else nestedTpl" [formGroup]="contentForm" (ngSubmit)="submit()" class="content-editor-wrapper" [ngClass]="{'nested': nested}">
  <ng-container *ngTemplateOutlet="mainTpl"></ng-container>
</form>

<ng-template #nestedTpl>
  <div [formGroup]="contentForm" class="content-editor-wrapper" [ngClass]="{'nested': nested}">
    <ng-container *ngTemplateOutlet="mainTpl"></ng-container>
  </div>
</ng-template>

<ng-template #mainTpl>
  <classifieds-ui-grid-layout cdkDropListGroup (itemAdded)="onItemAdded()" (itemRemoved)="onItemRemoved($event)" [options]="options" [dashboard]="dashboard">
    <ng-template #extraActions>
      <button *ngIf="savable" type="submit">Save</button>
    </ng-template>
    <ng-template #gridItemActions let-i="i">
      <button type="button" (mousedown)="addContent(i)" (touchstart)="addContent(i)">Add Content</button>
    </ng-template>
    <ng-template #innerGridItem let-i="i">
      <ngx-dropzone [cdkDropListData]="i" class="panel-dropzone" [multiple]="true" [disableClick]="true" (change)="onFileChange($event, i)" cdkDropList (cdkDropListDropped)="onDrop($event)">
        <div #panes>
          <classifieds-ui-editable-pane *ngFor="let pane of panelPanes(i).controls; let j = index" class="editable-pane" (rendererOverride)="onOverrideRenderer(i, j)" (removeRendererOverride)="onRemoveOverrideRenderer(i, j)" (edit)="onPaneEdit(i, j)" (delete)="onPaneDelete(i, j)" [panelIndex]="i" [paneIndex]="j" [name]="panelPaneName(i, j)" [label]="panelPaneLabel(i, j)" [pluginName]="panelPanePlugin(i, j)" [settings]="panelPaneSettings(i, j)" cdkDrag>
            <div class="custom-placeholder" *cdkDragPlaceholder></div>
          </classifieds-ui-editable-pane>
        </div>
      </ngx-dropzone>
    </ng-template>
  </classifieds-ui-grid-layout>
</ng-template>
<!-- [formControl]="panelPaneNestedControl(i, j)" -->
<!-- [panelPage]="panelPanePanelPage(i, j) | async" -->
